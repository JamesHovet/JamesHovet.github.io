<!DOCTYPE HTML>
<head>
    <script src="../scripts/d3.min.js"></script>
    <script src="../scripts/color-thief.min.js"></script>
    <script src="../scripts/Vibrant.min.js"></script>
</head>

<body>

    <div id="svgDiv">
        <svg width="200" height="200">
            <g transform="scale(1)">
                <g transform="translate(100,100)" id="set0">
                </g>
            </g>
        </svg>
    </div>
    <svg width="100" height="100">
  <defs>

  </defs>
  <circle id='top' cx="50" cy="50" r="50" fill="url(#pattern1)"/>
</svg>
</body>

<style>


</style>

<script>

    console.log(window.location)
    console.log(window.location.hash)

    // var url = "https://i.scdn.co/image/b0da4d3af09485434503aec6c83817df0c38f6ef"

    var url = "https://i.scdn.co/image/4df3b334d17428ba101ac867e6f97a0196af1635"

    var w = 1400;
    var h = 400;

    var songIndex = 0

    function httpGetAsync(theUrl, callback)
    {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function() {
            if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                callback(xmlHttp.responseText);
        }
        xmlHttp.open("GET", theUrl, true); // true for asynchronous
        xmlHttp.send(null);
    }




    data=[60,50,30,80,100,65,40,30]
    // data=[10,50,30]

    var clipPaths=[
        "M0,0 L 0,-100 L 100,-100  Z",
        "M0,0 L 100,0  L 100,-100  Z",
        "M0,0 L 100,0  L 100,100   Z",
        "M0,0 L 0,100  L 100,100   Z",
        "M0,0 L 0,100  L -100,100  Z",
        "M0,0 L -100,0 L -100,100  Z",
        "M0,0 L -100,0 L -100,-100 Z",
        "M0,0 L 0,-100 L -100,-100 Z"
    ]

    // var img = new Image;
    //
    // img.onload = {};
    // img.crossOrigin = '';
    // img.src = url
    // img.width = 300
    // img.height = 300

    // var colorThief = new ColorThief();
    // var barColor = rgb(colorThief.getColor(img))

    var img = document.createElement('img');
    img.crossOrigin = '';
    img.setAttribute('src', url)
    // document.body.appendChild(img)

    var barColor

    img.addEventListener('load', function() {
        var vibrant = new Vibrant(img);
        var swatches = vibrant.swatches()
        barColor = swatches["Vibrant"].getHex()

        var bars_g = document.getElementById("bars_0")
        bars_g.setAttribute("fill",barColor)

    });



    //start main d3 stuff
    var vis = d3.select("svg").append("g").attr("transform","translate(100,100)");
    var vis = d3.select("#set0")

    vis.append("defs")
        .append('pattern')
        .attr('id', 'albumCover')
        .attr('patternContentUnits', 'objectBoundingBox')
        .attr('width', "100%")
        .attr('height', "100%")
        .append("image")
        .attr("xlink:href", url)
        .attr('width', 1)
        .attr('height', 1)

    //create the clip paths
    vis.selectAll("clipPath")
        .data(clipPaths)
        .enter()
        .append("clipPath")
        .attr("id", (d,i) => {return"tri" + i+ "_" + String(songIndex)})
        .append("path")
        .attr("d",(d) => {return d})

    vis.append("g")
        .attr("id","bars_" + String(songIndex))
        .attr("fill","white")
        .selectAll("circle")
        .data(data)
        .enter()
        .append("circle")
        .attr("cx",0)
        .attr("cy",0)
        .attr("r",(d) => {return d/2.1 + 50})
        .attr("clip-path",(d,i) => {return"url(#tri" + i+ "_" + String(songIndex) + ")"})
        .attr("fill",barColor)

    vis.append("g")
        .attr("fill","none")
        .attr("stroke","white")
        .attr("stroke-width","5")
        .selectAll("path")
        .data(clipPaths)
        .enter()
        .append("path")
        .attr("d",(d)=> {console.log(d);return d})

    vis.append("circle")
        .attr("cx",0)
        .attr("cy",0)
        .attr("r",50)
        .attr("fill","url(#albumCover)")
        .attr("stroke","white")
        .attr("stroke-width","5")

</script>
